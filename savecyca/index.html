<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>중앙예닮학교를 지켜라!(고1수능영어)</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body { font-family: 'Pretendard', 'Noto Sans KR', sans-serif; background: #f8fafc; text-align: center; min-height: 100vh;}
    .centered-container { min-height: 55vh; display: flex; flex-direction: column; align-items: center; justify-content: center;}
    h2#gameTitle {
      font-size: 2.1rem; font-weight: bold; color: #6366f1;
      margin: 36px 0 8px 0; letter-spacing: 1px;
      text-shadow: 0 3px 18px #a5b4fc33;
    }
    #startBtn, #restartBtn { font-size: 1.35rem; font-weight: bold; padding: 16px 44px; border-radius: 20px; background: linear-gradient(90deg,#a5b4fc,#818cf8 80%); color: #222; border: none; margin: 36px auto 0 auto; display: block; cursor: pointer; box-shadow: 0 4px 32px #6366f155; transition: 0.13s;}
    #startBtn:hover, #restartBtn:hover { background: linear-gradient(90deg,#6366f1 10%,#a5b4fc 100%); color: #fff;}
    #gameArea { 
      margin: 0 auto 18px auto; 
      width: 900px; height: 420px; 
      border: 4px solid #6366f1; 
      border-radius: 24px; 
      background: #fff; 
      box-shadow: 0 8px 36px 0 #6366f110; 
      position: relative; 
      overflow: hidden; 
      display: flex; 
      align-items: flex-end; 
      justify-content: space-between; 
      min-width: 600px;
      padding-top: 36px;
    }
    #goblinArea { width: 210px; height: 100%; display: flex; align-items: flex-end; justify-content: center; z-index: 5;}
    #goblinImg { width: 120px; height: auto; transition: 0.25s;}
    #castle { width: 230px; height: 230px; margin-bottom: 6px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;}
    #castle-img { width: 230px; height: auto; display: block; }
    #castle-schoolname {
      font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
      font-size: 1.7rem;
      font-weight: bold;
      margin-top: -8px;
      color: #3730a3;
      text-shadow: 0 2px 6px #fff, 0 0 2px #6366f155;
      user-select: none;
      pointer-events: none;
      letter-spacing: 1.1px;
    }
    #weaponStone {
      position: absolute; left: 165px; top: 190px;
      width: 130px; height: 105px; z-index: 10;
      transition: left 1s cubic-bezier(.6,-0.3,.7,1.2), top 1s cubic-bezier(.6,-0.3,.7,1.2), transform 1s cubic-bezier(.6,-0.3,.7,1.2);
    }
    .stone-svg { width: 130px; height: 105px; display: block; transition: 0.25s;}
    .stone-word { font-size: 1.55rem; font-weight: bold; fill: #222; text-anchor: middle; dominant-baseline: middle; pointer-events: none; user-select: none;}
    #arrow {
      position: absolute; z-index: 50;
      width: 70px; height: 12px;
      left: 660px; top: 185px;
      opacity: 0;
      transition: left 0.39s linear, top 0.39s linear, opacity 0.09s;
    }
    #choices { margin: 32px auto 12px auto; width: 820px; display: flex; flex-wrap: wrap; justify-content: center; gap: 24px;}
    .choice-btn { padding: 16px 40px; font-size: 21px; border: none; border-radius: 16px; background: linear-gradient(90deg,#a5b4fc,#818cf8 60%); color: #1e293b; font-weight: bold; box-shadow: 0 2px 12px #818cf880; cursor: pointer; transition: 0.12s;}
    .choice-btn:hover { background: linear-gradient(90deg,#6366f1 10%,#a5b4fc 100%); color: #fff; transform: scale(1.09);}
    #infoBar { width: 880px; margin: 0 auto 10px auto; display: flex; gap: 14px; justify-content: center; align-items: center;}
    #timer, #score, #castleHp { font-size: 23px; font-weight: 500; color: #3730a3; background: #f1f5f9b8; border-radius: 13px; padding: 6px 24px; box-shadow: 0 2px 6px #818cf840; margin: 0 8px; display: inline-block;}
    #feedback {
      position: fixed;
      left: 50%;
      top: 66%;
      transform: translate(-50%, -50%);
      font-size: 1.45rem;
      font-weight: bold;
      color: #fff;
      border-radius: 15px;
      width: 310px;
      z-index: 1000;
      padding: 24px 12px;
      display: none;
      box-shadow: 0 8px 32px #818cf880;
      letter-spacing: 1.5px;
      background: rgba(55,48,163,0.93);
      text-align: center;
    }
    #pauseMsg { display: none; position: fixed; left: 0; right: 0; top: 43%; margin: 0 auto; z-index: 2000; font-size: 2.3rem; background: rgba(24,24,32,0.94); color: #fff; border-radius: 25px; width: 420px; padding: 38px 18px; text-align: center; font-weight: bold; box-shadow: 0 8px 32px #818cf880; }
  </style>
</head>
<body>
  <h2 id="gameTitle">중앙예닮학교를 지켜라!(고1수능영어)</h2>
  <div class="centered-container" id="startContainer">
    <button id="startBtn">게임 시작</button>
  </div>
  <div id="pauseMsg">게임이 종료되었습니다.<br>F5 또는 시작 버튼을 눌러 재시작하세요.</div>
  <div id="infoBar" style="display:none">
    <div id="score">점수: 0</div>
    <div id="castleHp">성 체력: 10</div>
    <div id="timer">남은 시간: 10초</div>
  </div>
  <div id="gameArea" style="display:none">
    <div id="goblinArea">
      <img id="goblinImg" src="1.png">
    </div>
    <div id="weaponStone"></div>
    <div id="castle">
      <img id="castle-img" src="a-1.png" alt="성 이미지">
      <div id="castle-schoolname">중앙예닮학교</div>
    </div>
    <img id="arrow" src="화살.png" style="display:none;">
  </div>
  <div id="choices"></div>
  <div id="feedback"></div>
  <button id="restartBtn" style="display:none;">다시 시작</button>
  <script>
    const shuffleChoices = true;
    let words = [];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    let score = 0, castleHp = 10, current = 0, timer = null, timeLeft = 10, gameOn = false, animating = false;

    function stoneSVG(word) {
      return `
      <svg class="stone-svg" viewBox="0 0 130 105">
        <ellipse cx="67" cy="55" rx="55" ry="44" fill="#b6b6b8" stroke="#47474a" stroke-width="6"/>
        <ellipse cx="52" cy="43" rx="16" ry="9" fill="#d1d1d4" opacity="0.55"/>
        <ellipse cx="80" cy="67" rx="11" ry="7" fill="#e6e6eb" opacity="0.35"/>
        <ellipse cx="95" cy="41" rx="7" ry="6" fill="#fff" opacity="0.17"/>
        <ellipse cx="49" cy="70" rx="15" ry="7" fill="#a2a2a2" opacity="0.29"/>
        <ellipse cx="72" cy="45" rx="10" ry="4" fill="#fff" opacity="0.17"/>
        <ellipse cx="67" cy="90" rx="35" ry="8" fill="#6c6c75" opacity="0.23"/>
        <text x="67" y="63" font-size="1.55rem" font-family="'Pretendard','Noto Sans KR',sans-serif"
         fill="#222" font-weight="bold" text-anchor="middle" dominant-baseline="middle">${word}</text>
      </svg>
      `;
    }

    function setCastleImg() {
      let hp = Math.max(1, Math.min(10, castleHp));
      document.getElementById('castle-img').src = `a-${hp}.png`;
    }

    function resetGoblinAndStone() {
      const goblin = document.getElementById('goblinImg');
      goblin.src = "1.png";
      goblin.style.width = "120px";
      const stone = document.getElementById('weaponStone');
      stone.innerHTML = '';
      stone.style.left = '165px';
      stone.style.top = '190px';
      stone.style.transform = 'translate(0px,0px)';
      document.getElementById('choices').innerHTML = '';
      const arrow = document.getElementById('arrow');
      arrow.style.display = "none";
      arrow.style.left = '660px';
      arrow.style.top = '185px';
      arrow.style.opacity = 0;
    }

    function showFeedback(word, meaning, isCorrect) {
      const feedback = document.getElementById('feedback');
      feedback.innerHTML = `<div style="font-size:1.17rem;margin-bottom:7px;${isCorrect?'color:#3b82f6':'color:#ef4444'}">${isCorrect?'정답!':'오답!'}</div>
        <div>${word}</div>
        <div style="font-size:1.07rem;margin-top:8px; color:${isCorrect ? '#3b82f6' : '#ef4444'}">
          뜻: ${meaning}
        </div>`;
      feedback.style.display = 'block';
      setTimeout(() => { feedback.style.display = 'none'; }, 1800);
    }

    function endGame(message) {
      if(timer) clearInterval(timer);
      document.getElementById('pauseMsg').style.display = 'block';
      gameOn = false;
      document.getElementById('gameArea').style.display = 'none';
      document.getElementById('infoBar').style.display = 'none';
      document.getElementById('restartBtn').style.display = '';
      if(message) alert(message);
    }

    function nextQuestion() {
      if (!gameOn || words.length === 0) return;
      if (castleHp <= 0) { endGame('성 무너짐! 점수: ' + score); return; }
      if (current >= words.length) { shuffle(words); current = 0; }

      resetGoblinAndStone();
      animating = true;
      setCastleImg();

      setTimeout(() => {
        const goblin = document.getElementById('goblinImg');
        goblin.src = "2.png";
        goblin.style.width = "120px";
        const stone = document.getElementById('weaponStone');
        stone.innerHTML = stoneSVG(words[current].word);
        stone.style.left = '165px';
        stone.style.top = '190px';
        stone.style.transform = 'translate(0,0)';
        setTimeout(()=>{
          stone.style.left = '340px';
          stone.style.top = '130px';
          stone.style.transform = 'translateY(-25px)';
        }, 100);
        setTimeout(() => {
          let q = words[current];
          let choices = [q.meaning, ...q.wrongs];
          if (shuffleChoices) choices = choices.sort(() => Math.random() - 0.5);
          let html = '';
          choices.forEach(choice => {
            html += `<button class="choice-btn" onclick="checkAnswer('${choice}')">${choice}</button>`;
          });
          document.getElementById('choices').innerHTML = html;
          animating = false;
        }, 1100);
      }, 1400);

      timeLeft = 10;
      document.getElementById('timer').textContent = '남은 시간: ' + timeLeft + '초';
      if (timer) clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = '남은 시간: ' + timeLeft + '초';
        if (timeLeft <= 0) {
          clearInterval(timer);
          let q = words[current];
          castleHp -= 1;
          setCastleImg();
          document.getElementById('castleHp').textContent = '성 체력: ' + castleHp; // 바로 갱신
          document.getElementById('goblinImg').src = "3.png";
          showFeedback(q.word, q.meaning, false);
          setTimeout(() => { current++; nextQuestion(); }, 1800);
        }
      }, 1000);
    }

    function shootArrowToStone() {
      const arrow = document.getElementById('arrow');
      const stone = document.getElementById('weaponStone');
      arrow.style.display = "block";
      arrow.style.left = '660px';
      arrow.style.top = '185px';
      arrow.style.opacity = 1;
      setTimeout(() => {
        arrow.style.left = '360px';
        arrow.style.top = '142px';
      }, 20);
      setTimeout(() => {
        let svg = stone.querySelector('svg');
        if(svg) {
          svg.style.transition = "0.18s";
          svg.style.transform = "scale(1.13) rotate(-12deg)";
          svg.style.opacity = "0.5";
          setTimeout(()=>{
            svg.style.transform = "";
            svg.style.opacity = "1";
          },150);
        }
        arrow.style.opacity = 0;
      }, 400);
      setTimeout(() => {
        arrow.style.display = "none";
      }, 600);
    }

    function checkAnswer(choice) {
      if (!gameOn || animating) return;
      if (timer) clearInterval(timer);
      const q = words[current];
      const isCorrect = (choice === q.meaning);
      if(isCorrect) {
        shootArrowToStone();
      } else {
        castleHp -= 1;
        setCastleImg();
        document.getElementById('castleHp').textContent = '성 체력: ' + castleHp; // 바로 갱신
        document.getElementById('goblinImg').src = "3.png";
      }
      showFeedback(q.word, q.meaning, isCorrect);
      setTimeout(() => {
        if (isCorrect) {
          score += 100;
          document.getElementById('score').textContent = '점수: ' + score;
        }
        current++;
        nextQuestion();
      }, 1800);
    }

    function startGame() {
      if(words.length === 0) {
        alert('단어 데이터를 불러오지 못했습니다.');
        return;
      }
      shuffle(words);
      score = 0; castleHp = 10; current = 0; gameOn = true; animating = false;
      document.getElementById('score').textContent = '점수: 0';
      document.getElementById('castleHp').textContent = '성 체력: 10';
      document.getElementById('timer').textContent = '남은 시간: 10초';
      document.getElementById('choices').innerHTML = '';
      document.getElementById('gameArea').style.display = 'flex';
      document.getElementById('infoBar').style.display = 'flex';
      document.getElementById('startContainer').style.display = 'none';
      document.getElementById('pauseMsg').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'none';
      setCastleImg();
      nextQuestion();
    }

    document.getElementById('startBtn').onclick = startGame;
    document.getElementById('restartBtn').onclick = function() {
      document.getElementById('startContainer').style.display = '';
      document.getElementById('pauseMsg').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'none';
    };

    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && gameOn) {
        endGame('게임을 ESC로 종료했습니다.');
      }
    });

    // words.txt 불러오기
    fetch('words.txt')
      .then(res => res.text())
      .then(txt => {
        try {
          words = JSON.parse(txt);
        } catch(e) {
          alert('단어 파일(words.txt) 파싱 오류');
        }
      })
      .catch(() => {
        alert('words.txt 파일을 찾을 수 없습니다.');
      });
  </script>
</body>
</html>
